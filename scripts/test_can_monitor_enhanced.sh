#!/bin/bash

# æµ‹è¯•å¢å¼ºç‰ˆCANç›‘æ§å™¨

echo -e "${CYAN}${BOLD}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                æµ‹è¯•å¢å¼ºç‰ˆCANç›‘æ§å™¨                           â•‘"
echo "â•‘           åŸºäºåŸå§‹can_monitor.shï¼Œå¢å¼ºæ˜¾ç¤ºåŠŸèƒ½                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"

echo -e "${GREEN}âœ¨ å¢å¼ºåŠŸèƒ½éªŒè¯:${NC}"
echo -e "  âœ“ ä¿æŒåŸå§‹can_monitor.shçš„å®Œæ•´ç»“æ„å’Œé£æ ¼"
echo -e "  âœ“ å¢åŠ 6åˆ—æ•°æ®æ˜¾ç¤º: ä½ç½®ã€é€Ÿåº¦ã€åŠ›çŸ©ç­‰"
echo -e "  âœ“ æ·»åŠ è¯¦ç»†ä¿¡æ¯è¡¨æ ¼: æ¸©åº¦ã€çŠ¶æ€ã€æ—¶é—´"
echo -e "  âœ“ å¢å¼ºç»Ÿè®¡ä¿¡æ¯: æ´»è·ƒç”µæœºã€å¹³å‡é¢‘ç‡ã€æ•°æ®å®Œæ•´æ€§"
echo -e "  âœ“ æ”¯æŒçœŸå®CANæ¥å£(can0)æ•°æ®ç›‘æ§"
echo -e "  âœ“ å½©è‰²çŠ¶æ€æ˜¾ç¤ºï¼Œä¾¿äºè¯†åˆ«å¼‚å¸¸"
echo ""

echo -e "${YELLOW}ğŸ”§ æŠ€æœ¯è§„æ ¼:${NC}"
echo -e "  â€¢ ç›‘æ§ç”µæœº: Motor 1-4 (CAN ID: 201-204)"
echo -e "  â€¢ æ¥å£: can0 (FDCANæ€»çº¿)"
echo -e "  â€¢ æ•°æ®æ ¼å¼: 8å­—èŠ‚CANå¸§"
echo -e "  â€¢ åˆ·æ–°é¢‘ç‡: æ¯50å¸§æ›´æ–°æ˜¾ç¤º"
echo -e "  â€¢ è§£ææ”¯æŒ: ä½ç½®(rad)ã€é€Ÿåº¦(rad/s)ã€åŠ›çŸ©(NÂ·m)ã€æ¸©åº¦(Â°C)"
echo ""

echo -e "${BLUE}ğŸ“Š æ˜¾ç¤ºè¡¨æ ¼æ ¼å¼:${NC}"
echo "  ä¸»è¡¨: ç”µæœºID | å¸§æ•° | é¢‘ç‡(Hz) | ä½ç½®(rad) | é€Ÿåº¦(rad/s) | åŠ›çŸ©(NÂ·m)"
echo "  è¯¦æƒ…è¡¨: ç”µæœºID | æ¸©åº¦ | çŠ¶æ€ | æœ€åæ›´æ–°æ—¶é—´"
echo "  ç»Ÿè®¡ä¿¡æ¯: æ´»è·ƒç”µæœºæ•°é‡ã€å¹³å‡é¢‘ç‡ã€æ•°æ®å®Œæ•´æ€§"
echo ""

echo -e "${MAGENTA}ğŸš€ å¯åŠ¨æµ‹è¯•:${NC}"
echo -e "ç°åœ¨å¯åŠ¨å¢å¼ºç‰ˆCANç›‘æ§å™¨ï¼Œå®ƒå°†:"
echo -e "  1. è¿æ¥åˆ°çœŸå®çš„can0æ¥å£"
echo -e "  2. ç›‘æ§Motor 1-4çš„CANé€šä¿¡"
echo -e "  3. å®æ—¶è§£æå¹¶æ ¼å¼åŒ–æ˜¾ç¤ºæ•°æ®"
echo -e "  4. æ¯50å¸§æ›´æ–°ä¸€æ¬¡ç•Œé¢æ˜¾ç¤º"
echo ""

# æ£€æŸ¥ä¾èµ–
if ! command -v candump &> /dev/null; then
    echo -e "${RED}âŒ é”™è¯¯: candumpæœªå®‰è£…${NC}"
    echo -e "${YELLOW}å®‰è£…æ–¹æ³•: sudo apt-get install can-utils${NC}"
    exit 1
fi

# æ£€æŸ¥CANæ¥å£
if ip link show can0 &> /dev/null; then
    echo -e "${GREEN}âœ“ CANæ¥å£ can0 å·²å°±ç»ª${NC}"
else
    echo -e "${YELLOW}âš ï¸  CANæ¥å£ can0 æœªå¯ç”¨${NC}"
    echo -e "${BLUE}å¯åŠ¨æ–¹æ³•: sudo ip link set can0 up type can bitrate 500000${NC}"
    echo ""
    echo -e "${CYAN}ç»§ç»­æµ‹è¯•(å°†ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼)æˆ–æŒ‰ Ctrl+C é€€å‡º...${NC}"
    read -t 5 -p "æŒ‰ Enter ç»§ç»­: " || exit 0
fi

echo ""
echo -e "${GREEN}ğŸ¯ å¯åŠ¨å¢å¼ºç‰ˆCANç›‘æ§å™¨...${NC}"
echo ""

# å¯åŠ¨å¢å¼ºç‰ˆç›‘æ§å™¨
exec ./scripts/can_monitor_enhanced.sh